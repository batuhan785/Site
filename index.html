<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ã–ÄŸrenci PortalÄ± PRO</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:'Poppins','Segoe UI',sans-serif;}
:root {
  --primary-dark: #1e3a8a;
  --accent-warning: #f59e0b;
  --accent-danger: #dc2626;
  --accent-success: #059669;
  --bg-dark: #0f172a;
  --bg-card: #1e293b;
  --text-light: #f8fafc;
  --border-color: #334155;
}
body{background:linear-gradient(135deg, var(--bg-dark), #1e3a8a, #0f766e);color:var(--text-light);min-height:100vh;overflow-x:hidden;}
.login-modal{display:flex;position:fixed;z-index:1000;left:0;top:0;width:100%;height:100%;background-color:rgba(0,0,0,0.8);align-items:center;justify-content:center;}
.login-content{background:var(--bg-card);padding:30px;border-radius:15px;width:90%;max-width:400px;border:2px solid var(--accent-warning);text-align:center;}
.login-content h2{margin-bottom:20px;color:var(--accent-warning);}
.login-content input{padding:12px;margin:10px 0;width:100%;border-radius:8px;border:1px solid var(--accent-warning);background:rgba(255,255,255,0.1);color:white;}
.login-btn{background:linear-gradient(135deg,var(--accent-warning),var(--accent-danger));color:white;border:none;padding:12px;width:100%;border-radius:8px;cursor:pointer;margin-top:10px;font-size:16px;}
header{background:rgba(15, 23, 42, 0.9);padding:14px 18px;display:flex;align-items:center;box-shadow:0 2px 10px rgba(0,0,0,0.5);position:sticky;top:0;z-index:100;backdrop-filter:blur(8px);border-bottom:1px solid var(--border-color);}
.menu-btn{font-size:24px;cursor:pointer;margin-right:12px;color:var(--accent-warning);}
.header-title{flex:1;text-align:center;font-size:1.45rem;font-weight:600;}
.user-info{margin-left:auto;font-size:0.9rem;color:var(--accent-warning);text-align:right;cursor:pointer;}
.user-info small{display:block;font-size:0.7rem;color:#ccc;}
.sidebar{width:260px;background:var(--bg-card);position:fixed;top:0;left:-260px;height:100%;padding-top:70px;transition:left .3s ease;z-index:200;overflow-y:auto;backdrop-filter:blur(10px);border-right:1px solid var(--border-color);}
.sidebar.active{left:0;}
.sidebar a{display:block;color:var(--text-light);padding:15px 20px;text-decoration:none;border-bottom:1px solid var(--border-color);}
.sidebar a:hover{background:rgba(245,158,11,0.15);}
.overlay{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.4);z-index:150;}
.overlay.active{display:block;}
.container{padding:22px;max-width:1100px;margin:0 auto;}
.countdown-container{width:100%;background:var(--bg-card);border-radius:18px;padding:26px;margin-bottom:26px;box-shadow:0 10px 30px rgba(0,0,0,0.28);border:1px solid var(--border-color);text-align:center;}
.countdown-title{font-size:1.75rem;margin-bottom:18px;font-weight:700;color:var(--accent-warning);}
.countdown-row{display:flex;gap:14px;justify-content:center;margin-bottom:10px;}
.countdown-item{background:rgba(255,255,255,0.08);padding:18px 12px;border-radius:14px;display:flex;flex-direction:column;align-items:center;min-width:64px;border:1px solid var(--border-color);}
.countdown-item span.value{font-size:2.1rem;font-weight:800;color:var(--accent-warning);}
.countdown-item label{margin-top:6px;font-size:0.95rem;color:rgba(255,255,255,0.92);}
.holiday-info{font-size:1.05rem;margin-top:16px;color:var(--accent-warning);font-weight:600;}
.content{display:none;animation:fadeIn .4s ease;}
.content.active{display:block;}
.card{background:var(--bg-card);padding:22px;margin:18px 0;border-radius:14px;border:1px solid var(--border-color);position:relative;transition:transform 0.3s ease, box-shadow 0.3s ease;}
.card:hover{transform:translateY(-5px);box-shadow:0 10px 30px rgba(0,0,0,0.2);}
.card h3{margin-bottom:12px;font-size:1.35rem;border-left:6px solid var(--accent-warning);padding-left:12px;}
.delete-btn{position:absolute;top:12px;right:12px;background:var(--accent-danger);width:36px;height:36px;border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;border:none;color:white;}
.add-btn{position:fixed;bottom:28px;right:22px;width:68px;height:68px;border-radius:50%;background:linear-gradient(135deg,var(--accent-warning),var(--accent-danger));display:flex;align-items:center;justify-content:center;font-size:26px;cursor:pointer;z-index:120;box-shadow:0 4px 20px rgba(245, 158, 11, 0.3);border:none;color:white;}
input,select,textarea{padding:14px;width:100%;border-radius:10px;margin-bottom:14px;background:var(--bg-card);color:white;border:1px solid var(--border-color);}
button{background:linear-gradient(135deg,var(--accent-warning),var(--accent-danger));color:white;border:none;padding:12px;width:100%;border-radius:10px;font-size:15px;cursor:pointer;}
.modal{display:none;position:fixed;z-index:300;left:0;top:0;width:100%;height:100%;background-color:rgba(0,0,0,0.7);align-items:center;justify-content:center;}
.modal-content{background-color:var(--bg-card);padding:25px;border-radius:12px;width:90%;max-width:500px;border:1px solid var(--border-color);backdrop-filter:blur(10px);}
.close{color:var(--accent-warning);float:right;font-size:28px;font-weight:bold;cursor:pointer;}
#upcomingList li{margin:10px 0;padding:12px;background:rgba(255,255,255,0.06);border-radius:8px;list-style:none;}

/* Tatil deÄŸiÅŸtirici iÃ§in yeni stiller */
.change-countdown-btn {
  background: linear-gradient(135deg, #3b82f6, #1d4ed8);
  color: white;
  border: none;
  padding: 8px 16px;
  border-radius: 20px;
  cursor: pointer;
  font-size: 14px;
  margin-left: 10px;
  display: inline-flex;
  align-items: center;
  gap: 5px;
}

.holiday-selector-modal .modal-content {
  max-width: 400px;
}

.holiday-option {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid var(--border-color);
  padding: 15px;
  margin: 10px 0;
  border-radius: 10px;
  cursor: pointer;
  transition: all 0.3s ease;
}

.holiday-option:hover {
  background: rgba(245, 158, 11, 0.2);
  border-color: var(--accent-warning);
}

.holiday-option.active {
  background: linear-gradient(135deg, var(--accent-warning), var(--accent-danger));
  border-color: var(--accent-warning);
}

.holiday-dates {
  font-size: 0.9rem;
  color: #94a3b8;
  margin-top: 5px;
}

/* SYNC BUTONU STÄ°LLERÄ° */
.sync-button {
  background: linear-gradient(135deg, var(--accent-warning), var(--accent-danger));
  border: none;
  color: white;
  padding: 8px 16px;
  border-radius: 20px;
  font-size: 14px;
  cursor: pointer;
  font-weight: 600;
  box-shadow: 0 2px 8px rgba(245, 158, 11, 0.3);
  transition: all 0.3s ease;
  margin-left: 15px;
  display: inline-flex;
  align-items: center;
  gap: 5px;
}

.sync-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(245, 158, 11, 0.4);
}

.sync-button:disabled {
  opacity: 0.6;
  cursor: not-allowed;
  transform: none;
}

/* VERÄ° GÃ–NDERÄ°M BUTONU */
.data-send-btn {
  background: linear-gradient(135deg, #10b981, #059669);
  border: none;
  color: white;
  padding: 10px 20px;
  border-radius: 20px;
  font-size: 14px;
  cursor: pointer;
  font-weight: 600;
  box-shadow: 0 2px 8px rgba(16, 185, 129, 0.3);
  transition: all 0.3s ease;
  margin: 5px;
  display: inline-flex;
  align-items: center;
  gap: 8px;
}

.data-send-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);
}

.data-send-btn:disabled {
  opacity: 0.6;
  cursor: not-allowed;
  transform: none;
}

.status-message {
  padding: 10px 15px;
  border-radius: 8px;
  margin: 10px 0;
  font-size: 14px;
}

.status-success {
  background: rgba(16, 185, 129, 0.2);
  border-left: 4px solid #10b981;
  color: #10b981;
}

.status-error {
  background: rgba(239, 68, 68, 0.2);
  border-left: 4px solid #ef4444;
  color: #ef4444;
}

.status-sending {
  background: rgba(245, 158, 11, 0.2);
  border-left: 4px solid #f59e0b;
  color: #f59e0b;
}

/* Ã–NEM PUANI STÄ°LLERÄ° */
.importance-badge{display:inline-flex;align-items:center;gap:4px;padding:4px 8px;border-radius:6px;font-size:0.8rem;margin-left:8px;}
.importance-1{background:#6b7280; color:white;}
.importance-2{background:#3b82f6; color:white;}
.importance-3{background:#f59e0b; color:black;}
.importance-4{background:#ef4444; color:white;}
.importance-5{background:#dc2626; color:white;}
.urgent-card{border-left:6px solid var(--accent-danger) !important;background:linear-gradient(135deg, var(--bg-card), rgba(220, 38, 38, 0.1)) !important;}

/* SIRALAMA SÄ°STEMÄ° */
.sorting-controls {display:flex;gap:10px;margin-bottom:20px;align-items:center;flex-wrap:wrap;}
.sort-option {background:rgba(255,255,255,0.1);border:1px solid var(--border-color);padding:8px 16px;border-radius:8px;cursor:pointer;transition:all 0.3s ease;font-size:0.9rem;}
.sort-option.active {background:linear-gradient(135deg,var(--accent-warning),var(--accent-danger));border-color:var(--accent-warning);}
.sort-option:hover {background:rgba(245,158,11,0.2);}

/* SÄ±nav KonularÄ± Ã–zel Stilleri - GÃœNCELLENDÄ° */
.exam-card {background:var(--bg-card);border-radius:12px;margin-bottom:15px;border:1px solid var(--border-color);overflow:hidden;cursor:pointer;transition:transform 0.3s ease, box-shadow 0.3s ease;}
.exam-card:hover {transform:translateY(-3px);box-shadow:0 8px 25px rgba(0,0,0,0.15);}
.exam-header {background:linear-gradient(135deg,var(--accent-warning),var(--accent-danger));padding:15px 20px;display:flex;justify-content:space-between;align-items:center;}
.exam-header h3 {margin:0;font-size:1.2rem;}
.exam-header .toggle-icon {transition:transform 0.3s ease;}
.exam-header.active .toggle-icon {transform:rotate(180deg);}
.exam-topics {padding:0;max-height:0;overflow:hidden;transition:max-height 0.3s ease,padding 0.3s ease;}
.exam-topics.active {padding:15px 20px;max-height:1000px;}
.topic-item {padding:10px;margin:8px 0;background:rgba(255,255,255,0.05);border-radius:6px;border-left:3px solid var(--accent-success);}
.topic-item:last-child {margin-bottom:0;}
.topics-input-container {margin-bottom:15px;}
.topic-input-group {display:flex;gap:10px;margin-bottom:10px;align-items:center;}
.topic-input {flex:1;}
.add-topic-input-btn {background:#3b82f6;color:white;border:none;padding:8px 12px;border-radius:6px;cursor:pointer;width:auto;font-size:12px;}
.remove-topic-btn {background:var(--accent-danger);color:white;border:none;padding:8px 12px;border-radius:6px;cursor:pointer;width:auto;font-size:12px;}

/* POMODORO STÄ°LLERÄ° */
.pomodoro-container {
  background: var(--bg-card);
  border-radius: 18px;
  padding: 26px;
  margin-bottom: 26px;
  border: 1px solid var(--border-color);
  text-align: center;
}

.pomodoro-timer {
  font-size: 4rem;
  font-weight: 800;
  color: var(--accent-warning);
  margin: 20px 0;
  font-family: 'Courier New', monospace;
}

.pomodoro-controls {
  display: flex;
  gap: 10px;
  justify-content: center;
  margin-bottom: 20px;
  flex-wrap: wrap;
}

.pomodoro-btn {
  background: linear-gradient(135deg, var(--accent-warning), var(--accent-danger));
  color: white;
  border: none;
  padding: 10px 20px;
  border-radius: 8px;
  cursor: pointer;
  font-size: 14px;
  transition: all 0.3s ease;
}

.pomodoro-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);
}

.pomodoro-btn:disabled {
  background: #6b7280;
  cursor: not-allowed;
  transform: none;
}

.time-options {
  display: flex;
  gap: 10px;
  justify-content: center;
  margin-bottom: 20px;
}

.time-option {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid var(--border-color);
  padding: 10px 15px;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.3s ease;
}

.time-option.active {
  background: linear-gradient(135deg, var(--accent-warning), var(--accent-danger));
  border-color: var(--accent-warning);
}

.pomodoro-stats {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
  gap: 15px;
  margin-top: 20px;
}

.stat-card {
  background: rgba(255, 255, 255, 0.05);
  padding: 15px;
  border-radius: 10px;
  border: 1px solid var(--border-color);
}

.stat-value {
  font-size: 1.5rem;
  font-weight: 700;
  color: var(--accent-warning);
  display: block;
}

.stat-label {
  font-size: 0.8rem;
  color: #94a3b8;
  display: block;
  margin-top: 5px;
}

/* SEVÄ°YE SÄ°STEMÄ° */
.level-badge {
  display: inline-flex;
  align-items: center;
  gap: 5px;
  background: linear-gradient(135deg, #f59e0b, #d97706);
  color: white;
  padding: 4px 8px;
  border-radius: 12px;
  font-size: 0.8rem;
  margin-left: 8px;
}

.xp-bar {
  width: 100%;
  height: 8px;
  background: rgba(255, 255, 255, 0.1);
  border-radius: 4px;
  margin: 8px 0;
  overflow: hidden;
}

.xp-progress {
  height: 100%;
  background: linear-gradient(90deg, #10b981, #34d399);
  border-radius: 4px;
  transition: width 0.5s ease;
}

.leaderboard-item {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 12px;
  margin: 8px 0;
  background: rgba(255, 255, 255, 0.05);
  border-radius: 8px;
  border-left: 4px solid var(--accent-warning);
  transition: transform 0.2s ease;
}

.leaderboard-item:hover {
  transform: translateX(5px);
}

.leaderboard-rank {
  font-weight: 700;
  font-size: 1.2rem;
  color: var(--accent-warning);
  min-width: 30px;
  text-align: center;
}

.leaderboard-info {
  flex: 1;
}

.leaderboard-name {
  font-weight: 600;
  margin-bottom: 4px;
}

.leaderboard-level {
  font-size: 0.8rem;
  color: #94a3b8;
}

.leaderboard-xp {
  font-weight: 700;
  color: var(--accent-warning);
}

/* Ã–ÄŸrenci kartlarÄ±nda seviye gÃ¶sterimi */
.student-level {
  display: inline-block;
  background: linear-gradient(135deg, #f59e0b, #d97706);
  color: white;
  padding: 2px 8px;
  border-radius: 10px;
  font-size: 0.7rem;
  margin-left: 8px;
}

.student-item {
  padding: 12px;
  margin: 8px 0;
  background: rgba(255, 255, 255, 0.1);
  border-radius: 8px;
  border-left: 4px solid var(--accent-warning);
  transition: transform 0.2s ease;
}

.student-item:hover {
  transform: translateX(5px);
}

/* Ä°kili liderlik stilleri */
.leaderboard-section {
  margin-bottom: 30px;
}

.leaderboard-section h3 {
  color: var(--accent-warning);
  margin-bottom: 15px;
  border-left: 4px solid var(--accent-warning);
  padding-left: 10px;
}

.monthly-badge {
  background: linear-gradient(135deg, #3b82f6, #1d4ed8);
  color: white;
  padding: 2px 8px;
  border-radius: 10px;
  font-size: 0.7rem;
  margin-left: 8px;
}

.total-badge {
  background: linear-gradient(135deg, #f59e0b, #d97706);
  color: white;
  padding: 2px 8px;
  border-radius: 10px;
  font-size: 0.7rem;
  margin-left: 8px;
}

/* STREAK STÄ°LLERÄ° */
.streak-badge {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  padding: 4px 10px;
  border-radius: 12px;
  font-size: 0.8rem;
  font-weight: bold;
  color: white;
  margin-left: 8px;
}

/* BAÅARIM POPUP STÄ°LLERÄ° */
.achievement-popup {
  position: fixed;
  top: 20px;
  right: 20px;
  background: linear-gradient(135deg, var(--accent-warning), var(--accent-danger));
  color: white;
  padding: 15px;
  border-radius: 12px;
  box-shadow: 0 8px 25px rgba(0,0,0,0.3);
  z-index: 10000;
  animation: slideInRight 0.5s ease, slideOutRight 0.5s ease 2.5s forwards;
  border: 2px solid gold;
}

.achievement-content {
  display: flex;
  align-items: center;
  gap: 12px;
}

.achievement-icon {
  font-size: 2rem;
  animation: bounce 1s infinite;
}

.achievement-name {
  font-weight: bold;
  font-size: 1.1rem;
}

.achievement-desc {
  font-size: 0.9rem;
  opacity: 0.9;
}

.achievement-xp {
  font-weight: bold;
  color: gold;
  margin-top: 5px;
}

/* KONFETÄ° ANÄ°MASYONU */
.confetti {
  position: fixed;
  width: 10px;
  height: 10px;
  background: #ff0000;
  top: -10px;
  border-radius: 2px;
  animation: fall 2s linear forwards;
  z-index: 10000;
}

/* ANÄ°MASYON KEYFRAMES */
@keyframes fadeIn{from{opacity:0;}to{opacity:1;}}
@keyframes fall {
  to {
    transform: translateY(100vh) rotate(360deg);
    opacity: 0;
  }
}
@keyframes slideInRight {
  from {
    transform: translateX(100%);
    opacity: 0;
  }
  to {
    transform: translateX(0);
    opacity: 1;
  }
}
@keyframes slideOutRight {
  to {
    transform: translateX(100%);
    opacity: 0;
  }
}
@keyframes bounce {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-5px); }
}

/* PROFÄ°L SAYFASI STÄ°LLERÄ° */
.profile-header {
  text-align: center;
  padding: 20px;
  background: linear-gradient(135deg, var(--accent-warning), var(--accent-danger));
  border-radius: 15px;
  margin-bottom: 20px;
}

.profile-avatar {
  width: 80px;
  height: 80px;
  border-radius: 50%;
  border: 3px solid white;
  margin-bottom: 10px;
}

.stats-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
  gap: 15px;
  margin: 20px 0;
}

/* SENKRONÄ°ZASYON KONTROLLERÄ° */
.sync-controls {
  display: flex;
  gap: 10px;
  margin: 20px 0;
  flex-wrap: wrap;
}

.sync-btn {
  background: linear-gradient(135deg, #3b82f6, #1d4ed8);
  border: none;
  color: white;
  padding: 10px 20px;
  border-radius: 20px;
  cursor: pointer;
  font-size: 14px;
  transition: all 0.3s ease;
}

.sync-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
}

/* ACHIEVEMENT GALERÄ°SÄ° */
.achievements-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 15px;
  margin: 20px 0;
}

.achievement-card {
  background: var(--bg-card);
  padding: 15px;
  border-radius: 10px;
  text-align: center;
  border: 2px solid var(--border-color);
  transition: all 0.3s ease;
}

.achievement-card.unlocked {
  border-color: var(--accent-warning);
  background: linear-gradient(135deg, var(--bg-card), rgba(245, 158, 11, 0.1));
}

.achievement-card.locked {
  opacity: 0.6;
  filter: grayscale(1);
}

.achievement-icon-large {
  font-size: 3rem;
  margin-bottom: 10px;
}

/* PROGRESS BAR */
.progress-container {
  width: 100%;
  background: rgba(255, 255, 255, 0.1);
  border-radius: 10px;
  overflow: hidden;
  margin: 10px 0;
}

.progress-bar {
  height: 8px;
  background: linear-gradient(90deg, var(--accent-warning), var(--accent-danger));
  border-radius: 10px;
  transition: width 0.5s ease;
}

/* NOTLAR SÄ°STEMÄ° */
.notes-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
  gap: 15px;
}

.note-card {
  background: var(--bg-card);
  padding: 15px;
  border-radius: 10px;
  border-left: 4px solid var(--accent-warning);
  min-height: 150px;
  position: relative;
}

.note-content {
  margin-bottom: 10px;
}

.note-date {
  font-size: 0.8rem;
  color: #94a3b8;
  text-align: right;
}

/* YENÄ° NOT MODAL STÄ°LLERÄ° */
.note-modal .modal-content {
  max-width: 600px;
}

.note-categories {
  display: flex;
  gap: 10px;
  margin: 15px 0;
  flex-wrap: wrap;
}

.note-category {
  background: rgba(255, 255, 255, 0.1);
  padding: 8px 16px;
  border-radius: 20px;
  cursor: pointer;
  border: 1px solid var(--border-color);
  transition: all 0.3s ease;
  font-size: 0.9rem;
}

.note-category.active {
  background: linear-gradient(135deg, var(--accent-warning), var(--accent-danger));
  border-color: var(--accent-warning);
}

/* RESPONSIVE TASARIM */
@media (max-width: 768px) {
  .container {
    padding: 15px;
  }
  
  .countdown-row {
    flex-wrap: wrap;
  }
  
  .countdown-item {
    min-width: 70px;
  }
  
  .pomodoro-timer {
    font-size: 3rem;
  }
  
  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .sync-controls {
    flex-direction: column;
  }
  
  .sync-button {
    margin-left: 10px;
    padding: 6px 12px;
    font-size: 12px;
  }
}

/* LOADING ANIMATION */
.loading-spinner {
  width: 40px;
  height: 40px;
  border: 4px solid rgba(255, 255, 255, 0.1);
  border-left: 4px solid var(--accent-warning);
  border-radius: 50%;
  animation: spin 1s linear infinite;
  margin: 20px auto;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}
</style>
</head>
<body>

<!-- GiriÅŸ ModalÄ± -->
<div id="loginModal" class="login-modal">
  <div class="login-content">
    <h2>Ã–ÄŸrenci GiriÅŸi</h2>
    <input type="text" id="studentName" placeholder="AdÄ±nÄ±z">
    <input type="text" id="studentSurname" placeholder="SoyadÄ±nÄ±z">
    <button class="login-btn" id="loginBtn">GiriÅŸ Yap</button>
    <small>Bilgileriniz kaydedilecektir.</small>
  </div>
</div>

<!-- Tatil SeÃ§ici ModalÄ± -->
<div id="holidaySelectorModal" class="modal holiday-selector-modal">
  <div class="modal-content">
    <span class="close" id="closeHolidayModal">&times;</span>
    <h2>Tatil SeÃ§in</h2>
    <div id="holidayOptions">
      <div class="holiday-option" data-target="2026-01-21T10:00:00">
        <strong>15 Tatil</strong>
        <div class="holiday-dates">21 Ocak - 5 Åubat 2026</div>
      </div>
      <div class="holiday-option" data-target="2026-03-13T15:40:00">
        <strong>2. DÃ¶nem Ara Tatil</strong>
        <div class="holiday-dates">13-20 Mart 2026</div>
      </div>
      <div class="holiday-option" data-target="2026-06-26T10:00:00">
        <strong>Yaz Tatili</strong>
        <div class="holiday-dates">26 Haziran - 8 EylÃ¼l 2026</div>
      </div>
    </div>
    <button id="selectHolidayBtn">SeÃ§</button>
  </div>
</div>

<div class="overlay" id="overlay"></div>

<header>
  <div class="menu-btn" id="menuBtn"><i class="fas fa-bars"></i></div>
  <div class="header-title">Ã–ÄŸrenci PortalÄ± PRO</div>
  <button class="sync-button" id="syncButton">
    <i class="fas fa-sync-alt"></i> Sync
  </button>
  <div class="user-info" id="userInfo" style="display:none;">
    HoÅŸ geldiniz<br><small id="userName"></small>
  </div>
</header>

<div class="sidebar" id="sidebar">
  <a href="#" data-section="home"><i class="fas fa-home"></i> Ana Sayfa</a>
  <a href="#" data-section="exams"><i class="fas fa-file-alt"></i> SÄ±navlar</a>
  <a href="#" data-section="homeworks"><i class="fas fa-tasks"></i> Ã–devler</a>
  <a href="#" data-section="hadis"><i class="fas fa-book"></i> Hadis-i Åerifler</a>
  <a href="#" data-section="class"><i class="fas fa-users"></i> SÄ±nÄ±f Listesi</a>
  <a href="#" data-section="pomodoro"><i class="fas fa-clock"></i> Pomodoro Timer</a>
  <a href="#" data-section="leaderboard"><i class="fas fa-trophy"></i> Liderlik Tablosu</a>
  <a href="#" data-section="profile"><i class="fas fa-user"></i> Profilim</a>
  <a href="#" data-section="achievements"><i class="fas fa-medal"></i> BaÅŸarÄ±mlar</a>
  <a href="#" data-section="notes"><i class="fas fa-sticky-note"></i> NotlarÄ±m</a>
  <a href="#" data-section="data-send"><i class="fas fa-paper-plane"></i> Veri GÃ¶nderim</a>
  <a href="#" id="adminSwitch"><i class="fas fa-user-shield"></i> Admin Profiline GeÃ§iÅŸ Yap</a>
</div>

<div class="container">
  <!-- ANA SAYFA -->
  <div id="home" class="content active">
    <div class="countdown-container">
      <div class="countdown-title" id="countdownTitle">
        15 Tatiline Kalan SÃ¼re
        <button class="change-countdown-btn" id="changeCountdownBtn">
          <i class="fas fa-exchange-alt"></i> DeÄŸiÅŸtir
        </button>
      </div>
      
      <div class="countdown-row">
        <div class="countdown-item"><span id="days" class="value">00</span><label>GÃ¼n</label></div>
        <div class="countdown-item"><span id="hours" class="value">00</span><label>Saat</label></div>
        <div class="countdown-item"><span id="minutes" class="value">00</span><label>Dakika</label></div>
        <div class="countdown-item"><span id="seconds" class="value">00</span><label>Saniye</label></div>
      </div>
      <div class="holiday-info" id="holidayInfo">21 Ocak - 5 Åubat 2026</div>
    </div>
    
    <div class="card">
      <h3>HoÅŸ Geldiniz!</h3>
      <p id="welcomeMessage">Sol Ã¼stten menÃ¼ye tÄ±klayarak diÄŸer bÃ¶lÃ¼mlere eriÅŸebilirsiniz.</p>
    </div>
    
    <!-- YAKLAÅAN SINAVLAR/Ã–DEVLER -->
    <div class="card" id="upcomingCard">
      <h3>YaklaÅŸan SÄ±navlar/Ã–devler (2 GÃ¼n Kalanlar)</h3>
      <ul id="upcomingList"><li>YaklaÅŸan sÄ±nav veya Ã¶dev bulunmamaktadÄ±r.</li></ul>
    </div>

    <!-- HIZLI Ä°STATÄ°STÄ°KLER -->
    <div class="card">
      <h3>HÄ±zlÄ± Ä°statistikler</h3>
      <div class="stats-grid" id="quickStats">
        <div class="stat-card">
          <span class="stat-value" id="quickXP">0</span>
          <span class="stat-label">Toplam XP</span>
        </div>
        <div class="stat-card">
          <span class="stat-value" id="quickLevel">1</span>
          <span class="stat-label">Seviye</span>
        </div>
        <div class="stat-card">
          <span class="stat-value" id="quickStreak">0</span>
          <span class="stat-label">GÃ¼n Streak</span>
        </div>
        <div class="stat-card">
          <span class="stat-value" id="quickStudyTime">0</span>
          <span class="stat-label">Ã‡alÄ±ÅŸma (dk)</span>
        </div>
      </div>
    </div>
  </div>

  <!-- DÄ°ÄER BÃ–LÃœMLER -->
  <div id="exams" class="content">
    <h2 class="countdown-title">SÄ±navlar</h2>
    <div class="sorting-controls" id="examSorting">
      <div class="sort-option active" data-sort="importance-date">Ã–neme GÃ¶re (YÃ¼ksekâ†’DÃ¼ÅŸÃ¼k)</div>
      <div class="sort-option" data-sort="date">Tarihe GÃ¶re (YakÄ±nâ†’Uzak)</div>
      <div class="sort-option" data-sort="importance">Sadece Ã–nem Seviyesi</div>
    </div>
    <div id="examList"></div>
  </div>

  <div id="homeworks" class="content">
    <h2 class="countdown-title">Ã–devler</h2>
    <div id="homeworkList"></div>
  </div>

  <div id="hadis" class="content">
    <h2 class="countdown-title">Hadis-i Åerifler</h2>
    <div id="hadisList">
      <div class="card"><p>HenÃ¼z hadis eklenmedi.</p></div>
    </div>
  </div>

  <div id="class" class="content">
    <h2 class="countdown-title">SÄ±nÄ±f Listesi</h2>
    <div class="card">
      <div class="class-list" id="classList"><p>SÄ±nÄ±f listesi yÃ¼kleniyor...</p></div>
    </div>
  </div>

  <!-- POMODORO TIMER -->
  <div id="pomodoro" class="content">
    <div class="pomodoro-container">
      <h2 class="countdown-title">Pomodoro Timer</h2>
      
      <div class="time-options">
        <div class="time-option active" data-minutes="30">30 Dakika</div>
        <div class="time-option" data-minutes="60">60 Dakika</div>
        <div class="time-option" data-minutes="90">90 Dakika</div>
      </div>
      
      <div class="pomodoro-timer" id="pomodoroTimer">30:00</div>
      
      <div class="pomodoro-controls">
        <button class="pomodoro-btn" id="startPomodoro">BaÅŸlat</button>
        <button class="pomodoro-btn" id="pausePomodoro" disabled>Duraklat</button>
        <button class="pomodoro-btn" id="resetPomodoro">SÄ±fÄ±rla</button>
      </div>
      
      <div class="pomodoro-stats">
        <div class="stat-card">
          <span class="stat-value" id="totalStudyTime">0</span>
          <span class="stat-label">Toplam Ã‡alÄ±ÅŸma (dk)</span>
        </div>
        <div class="stat-card">
          <span class="stat-value" id="currentLevel">1</span>
          <span class="stat-label">Seviye</span>
        </div>
        <div class="stat-card">
          <span class="stat-value" id="currentXP">0</span>
          <span class="stat-label">XP</span>
        </div>
        <div class="stat-card">
          <span class="stat-value" id="currentStreak">0</span>
          <span class="stat-label">Ãœst Ãœste GÃ¼n</span>
        </div>
      </div>

      <div class="xp-bar">
        <div class="xp-progress" id="xpProgress" style="width: 0%"></div>
      </div>
      <small>Sonraki seviye: <span id="nextLevelXP">250</span> XP</small>

      <button class="data-send-btn" onclick="sendPomodoroData()" style="margin-top: 20px;">
        <i class="fas fa-paper-plane"></i> POMODORO VERÄ°LERÄ°NÄ° GÃ–NDER
      </button>
      <div id="pomodoroSendStatus"></div>
    </div>
  </div>

  <!-- LÄ°DERLÄ°K TABLOSU -->
  <div id="leaderboard" class="content">
    <div class="card">
      <h2 class="countdown-title">ğŸ† AYLIK LÄ°DERLÄ°K</h2>
      <p>Bu ayki Ã§alÄ±ÅŸma performansÄ± - Her ayÄ±n 1'inde sÄ±fÄ±rlanÄ±r</p>
      <div id="monthlyLeaderboard">
        <div class="leaderboard-item">
          <div class="leaderboard-rank">1</div>
          <div class="leaderboard-info">
            <div class="leaderboard-name">Ã–rnek Ã–ÄŸrenci <span class="monthly-badge">Bu Ay</span></div>
            <div class="leaderboard-level">0 XP â€¢ 0 dakika</div>
          </div>
          <div class="leaderboard-xp">ğŸ¥‡</div>
        </div>
      </div>
    </div>

    <div class="card">
      <h2 class="countdown-title">â­ TÃœM ZAMANLAR LÄ°DERLÄ°ÄÄ°</h2>
      <p>Kariyer performansÄ± - KalÄ±cÄ± istatistikler</p>
      <div id="totalLeaderboard">
        <div class="leaderboard-item">
          <div class="leaderboard-rank">1</div>
          <div class="leaderboard-info">
            <div class="leaderboard-name">Ã–rnek Ã–ÄŸrenci <span class="total-badge">Seviye 1</span></div>
            <div class="leaderboard-level">0 XP â€¢ 0 dakika</div>
          </div>
          <div class="leaderboard-xp">â­</div>
        </div>
      </div>
    </div>
  </div>

  <!-- PROFÄ°L SAYFASI -->
  <div id="profile" class="content">
    <div class="card">
      <div class="profile-header">
        <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAiIGhlaWdodD0iODAiIHZpZXdCb3g9IjAgMCA4MCA4MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iNDAiIGN5PSI0MCIgcj0iNDAiIGZpbGw9IiNmNTllMGIiLz4KPGNpcmNsZSBjeD0iNDAiIGN5PSIzMCIgcj0iMTUiIGZpbGw9IndoaXRlIi8+CjxwYXRoIGQ9Ik0yNSA2MEMyNSA2MCAzMCA0NSA0MCA0NUM1MCA0NSA1NSA2MCA1NSA2MEgyNVoiIGZpbGw9IndoaXRlIi8+Cjwvc3ZnPgo=" alt="Profil" class="profile-avatar">
        <h2 id="profileName">KullanÄ±cÄ± AdÄ±</h2>
        <div class="level-badge" id="profileLevel">Seviye 1</div>
      </div>
      
      <div class="stats-grid">
        <div class="stat-card">
          <span class="stat-value" id="profileTotalXP">0</span>
          <span class="stat-label">Toplam XP</span>
        </div>
        <div class="stat-card">
          <span class="stat-value" id="profileStudyTime">0</span>
          <span class="stat-label">Ã‡alÄ±ÅŸma SÃ¼resi</span>
        </div>
        <div class="stat-card">
          <span class="stat-value" id="profileSessions">0</span>
          <span class="stat-label">Oturum SayÄ±sÄ±</span>
        </div>
        <div class="stat-card">
          <span class="stat-value" id="profileStreak">0</span>
          <span class="stat-label">GÃ¼n Streak</span>
        </div>
      </div>

      <div class="progress-container">
        <div class="progress-bar" id="profileProgress" style="width: 0%"></div>
      </div>
      <small>Sonraki seviye: <span id="profileNextLevel">250</span> XP kaldÄ±</small>
    </div>

    <div class="card">
      <h3>ğŸ“Š AylÄ±k Performans</h3>
      <div class="stats-grid">
        <div class="stat-card">
          <span class="stat-value" id="monthlyXP">0</span>
          <span class="stat-label">Bu Ay XP</span>
        </div>
        <div class="stat-card">
          <span class="stat-value" id="monthlyStudyTime">0</span>
          <span class="stat-label">Bu Ay SÃ¼re</span>
        </div>
        <div class="stat-card">
          <span class="stat-value" id="monthlySessions">0</span>
          <span class="stat-label">Bu Ay Oturum</span>
        </div>
      </div>
    </div>
  </div>

  <!-- BAÅARIMLAR -->
  <div id="achievements" class="content">
    <h2 class="countdown-title">ğŸ† BaÅŸarÄ±mlar</h2>
    <div class="card">
      <div class="stats-grid">
        <div class="stat-card">
          <span class="stat-value" id="totalAchievements">0</span>
          <span class="stat-label">Toplam BaÅŸarÄ±m</span>
        </div>
        <div class="stat-card">
          <span class="stat-value" id="achievementXP">0</span>
          <span class="stat-label">BaÅŸarÄ±m XP</span>
        </div>
        <div class="stat-card">
          <span class="stat-value" id="completionRate">0%</span>
          <span class="stat-label">Tamamlama OranÄ±</span>
        </div>
      </div>
    </div>
    
    <div class="achievements-grid" id="achievementsList">
      <!-- BaÅŸarÄ±mlar buraya eklenecek -->
    </div>
  </div>

  <!-- NOTLAR -->
  <div id="notes" class="content">
    <h2 class="countdown-title">ğŸ“ NotlarÄ±m</h2>
    <div class="sync-controls">
      <button class="sync-btn" onclick="showAddNoteModal()"><i class="fas fa-plus"></i> Yeni Not Ekle</button>
    </div>
    <div class="notes-grid" id="notesList">
      <!-- Notlar buraya eklenecek -->
    </div>
  </div>

  <!-- VERÄ° GÃ–NDERÄ°M -->
  <div id="data-send" class="content">
    <div class="card">
      <h2>ğŸš€ VERÄ° GÃ–NDERÄ°M SÄ°STEMÄ°</h2>
      <p>LocalStorage'teki tÃ¼m verileri direkt Google Forms'a gÃ¶nder:</p>
      
      <div class="sync-controls">
        <button class="data-send-btn" onclick="syncAllData()">
          <i class="fas fa-paper-plane"></i> TÃœM VERÄ°LERÄ° GÃ–NDER
        </button>
        
        <button class="data-send-btn" onclick="sendPomodoroData()" style="background:linear-gradient(135deg, #f59e0b, #d97706);">
          <i class="fas fa-clock"></i> SADECE POMODORO VERÄ°LERÄ° GÃ–NDER
        </button>
      </div>
      
      <div id="sendStatus"></div>
    </div>

    <div class="card">
      <h3>ğŸ“Š Mevcut Veriler</h3>
      <div id="currentData">
        <p>Veriler yÃ¼kleniyor...</p>
      </div>
    </div>
  </div>
</div>

<div class="add-btn" id="addBtn"><i class="fas fa-plus"></i></div>

<!-- MODAL PENCERELERÄ° -->
<div id="addModal" class="modal">
  <div class="modal-content">
    <span class="close" id="closeAddModal">&times;</span>
    <h2>Yeni Ä°Ã§erik Ekle</h2>
    <select id="contentType">
      <option value="exam">SÄ±nav</option>
      <option value="homework">Ã–dev</option>
      <option value="hadis">Hadis-i Åerif</option>
    </select>
    <input type="text" id="contentTitle" placeholder="BaÅŸlÄ±k">
    <textarea id="contentDesc" placeholder="AÃ§Ä±klama"></textarea>
    <input type="datetime-local" id="contentDate" 
           placeholder="2025-11-14T21:14"
           title="Tarih formatÄ±: YYYY-AA-GG SS:DD (Ã–rnek: 2025-11-14T21:14)">
    <div id="importanceContainer">
      <select id="contentImportance">
        <option value="1">â­ DÃ¼ÅŸÃ¼k Ã–nem</option>
        <option value="2">â­â­ Orta Ã–nem</option>
        <option value="3" selected>â­â­â­ YÃ¼ksek Ã–nem</option>
        <option value="4">â­â­â­â­ Ã‡ok YÃ¼ksek</option>
        <option value="5">â­â­â­â­â­ KRÄ°TÄ°K</option>
      </select>
    </div>
    <button id="saveContentBtn">Kaydet</button>
  </div>
</div>

<!-- YENÄ° NOT MODALI -->
<div id="addNoteModal" class="modal note-modal">
  <div class="modal-content">
    <span class="close" id="closeNoteModal">&times;</span>
    <h2>ğŸ“ Yeni Not Ekle</h2>
    
    <input type="text" id="noteTitle" placeholder="Not BaÅŸlÄ±ÄŸÄ±">
    
    <div class="note-categories">
      <div class="note-category active" data-category="study">ğŸ“š Ã‡alÄ±ÅŸma</div>
      <div class="note-category" data-category="homework">ğŸ“‹ Ã–dev</div>
      <div class="note-category" data-category="personal">ğŸ”’ KiÅŸisel</div>
      <div class="note-category" data-category="reminder">â° HatÄ±rlatÄ±cÄ±</div>
    </div>
    
    <textarea id="noteContent" placeholder="Not iÃ§eriÄŸi..." rows="6"></textarea>
    <button id="saveNoteBtn">Notu Kaydet</button>
  </div>
</div>

<script>
// ğŸ”¥ TAM ENTEGRE SÄ°STEM
let exams = JSON.parse(localStorage.getItem('exams')) || [];
let homeworks = JSON.parse(localStorage.getItem('homeworks')) || [];
let hadises = JSON.parse(localStorage.getItem('hadises')) || [];
let students = JSON.parse(localStorage.getItem('students')) || [];
let examTopics = JSON.parse(localStorage.getItem('examTopics')) || [];
let userStats = JSON.parse(localStorage.getItem('userStats')) || {};
let notes = JSON.parse(localStorage.getItem('notes')) || [];
let currentUser = JSON.parse(localStorage.getItem('currentUser'));
let isAdmin = false;
let nextId = 1000;
let examSortType = "importance-date";

// Pomodoro deÄŸiÅŸkenleri
let pomodoroInterval = null;
let currentTime = 30 * 60;
let isRunning = false;
let selectedTime = 30;
let earnedXP = 0;
let startTime = null;

// ğŸ”¥ TATÄ°L SÄ°STEMÄ° GÃœNCELLENDÄ° - 15 TATÄ°L AKTÄ°F
let currentTargetDate = "2026-01-21T10:00:00";
let countdownInterval = null;

// Ã–nem seviyeleri
const importanceLevels = {
  1:{label:"DÃ¼ÅŸÃ¼k", icon:"â­", class:"importance-1"},
  2:{label:"Orta", icon:"â­â­", class:"importance-2"},
  3:{label:"YÃ¼ksek", icon:"â­â­â­", class:"importance-3"},
  4:{label:"Ã‡ok YÃ¼ksek", icon:"â­â­â­â­", class:"importance-4"},
  5:{label:"KRÄ°TÄ°K", icon:"â­â­â­â­â­", class:"importance-5"}
};

// ğŸ”¥ YENÄ° VERÄ° GÃ–NDERME URL'SÄ°
const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbx9PVECVoVyDthdItLQ-xPcFNx-vd9qb_QTjEnHIn3DxjYc4fu6UZbpKto7aqpQWnwEVQ/exec';
const SHEET_ID = '1UVpxOHs92qbRLestRIGuUfUYQ58NVJn3AJALSwiPPfY';
const CSV_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/export?format=csv`;

// STREAK RENK SÄ°STEMÄ°
const streakColors = {
  1: "#4b5563",   // Koyu gri
  3: "#d97706",   // Koyu turuncu
  7: "#dc2626",   // Koyu kÄ±rmÄ±zÄ±
  14: "#991b1b",  // Daha koyu kÄ±rmÄ±zÄ±
  30: "#7c3aed",  // Koyu mor
  60: "#059669",  // Koyu yeÅŸil
  90: "#0e7490"   // Koyu camgÃ¶beÄŸi
};

// ğŸ”¥ TATÄ°L BÄ°LGÄ°LERÄ° GÃœNCELLENDÄ°
const holidayInfo = {
  "2026-01-21T10:00:00": { title: "15 Tatiline Kalan SÃ¼re", info: "21 Ocak - 5 Åubat 2026" },
  "2026-03-13T15:40:00": { title: "2. DÃ¶nem Ara Tatiline Kalan SÃ¼re", info: "13-20 Mart 2026" },
  "2026-06-26T10:00:00": { title: "Yaz Tatiline Kalan SÃ¼re", info: "26 Haziran - 8 EylÃ¼l 2026" }
};

// ğŸ”¥ GENÄ°ÅLETÄ°LMÄ°Å BAÅARIM SÄ°STEMÄ°
class ExtendedAchievementSystem {
  constructor() {
    this.achievements = {
      "first_blood": {
        name: "Ä°lk Kan",
        desc: "Ä°lk Ã§alÄ±ÅŸma oturumunu tamamla",
        icon: "ğŸ©¸",
        xp: 50,
        condition: (user) => user.totalSessions >= 1
      },
      "streak_3": {
        name: "AteÅŸ BaÅŸlÄ±yor",
        desc: "3 gÃ¼n Ã¼st Ã¼ste Ã§alÄ±ÅŸ",
        icon: "ğŸ”¥",
        xp: 100,
        condition: (user) => user.currentStreak >= 3
      },
      "marathon": {
        name: "Maratoncu",
        desc: "Tek seferde 2 saat Ã§alÄ±ÅŸ",
        icon: "ğŸƒ",
        xp: 150,
        condition: (user) => user.longestSession >= 120
      },
      "perfect_week": {
        name: "MÃ¼kemmel Hafta",
        desc: "7 gÃ¼n Ã¼st Ã¼ste Ã§alÄ±ÅŸ",
        icon: "ğŸŒŸ",
        xp: 300,
        condition: (user) => user.currentStreak >= 7
      },
      "knowledge_seeker": {
        name: "Bilgi ArayÄ±cÄ±sÄ±",
        desc: "Toplam 1000 XP kazan",
        icon: "ğŸ“š",
        xp: 200,
        condition: (user) => user.totalXP >= 1000
      },
      "night_owl": {
        name: "Gece KuÅŸu",
        desc: "Gece 23:00 sonrasÄ± 5 Ã§alÄ±ÅŸma",
        icon: "ğŸ¦‰",
        xp: 150,
        condition: (user) => (user.nightSessions || 0) >= 5
      },
      "early_bird": {
        name: "Erkenci", 
        desc: "Sabah 07:00 Ã¶ncesi 5 Ã§alÄ±ÅŸma",
        icon: "ğŸŒ…",
        xp: 150,
        condition: (user) => (user.earlySessions || 0) >= 5
      },
      "weekend_warrior": {
        name: "Hafta Sonu SavaÅŸÃ§Ä±sÄ±",
        desc: "Hafta sonu 10 Ã§alÄ±ÅŸma",
        icon: "ğŸ†",
        xp: 200,
        condition: (user) => (user.weekendSessions || 0) >= 10
      },
      "streak_30": {
        name: "Maraton KoÅŸucusu",
        desc: "30 gÃ¼n Ã¼st Ã¼ste Ã§alÄ±ÅŸ",
        icon: "ğŸƒâ€â™‚ï¸",
        xp: 500,
        condition: (user) => user.currentStreak >= 30
      },
      "bookworm": {
        name: "Kitap Kurdu",
        desc: "1000 dakika Ã§alÄ±ÅŸma",
        icon: "ğŸ“–",
        xp: 300,
        condition: (user) => user.totalStudyTime >= 1000
      },
      "discipline_master": {
        name: "Disiplin Abidesi",
        desc: "50 oturum tamamlama",
        icon: "ğŸ’ª",
        xp: 400,
        condition: (user) => user.totalSessions >= 50
      }
    };
  }

  checkAchievements(userStats) {
    const unlocked = [];
    Object.keys(this.achievements).forEach(key => {
      const achievement = this.achievements[key];
      if (!userStats.unlockedAchievements?.includes(key) && 
          achievement.condition(userStats)) {
        unlocked.push(key);
        this.unlockAchievement(key, userStats);
      }
    });
    return unlocked;
  }

  unlockAchievement(achievementKey, userStats) {
    const achievement = this.achievements[achievementKey];
    
    userStats.totalXP += achievement.xp;
    
    if (!userStats.unlockedAchievements) userStats.unlockedAchievements = [];
    userStats.unlockedAchievements.push(achievementKey);
    
    this.showAchievementPopup(achievement);
    this.saveAchievementToSheets(achievementKey, userStats);
    
    localStorage.setItem('userStats', JSON.stringify(userStats));
    
    if (window.renderAchievements) renderAchievements();
    if (window.updateQuickStats) updateQuickStats();
  }

  showAchievementPopup(achievement) {
    this.createConfetti();
    
    const popup = document.createElement('div');
    popup.className = 'achievement-popup';
    popup.innerHTML = `
      <div class="achievement-content">
        <div class="achievement-icon">${achievement.icon}</div>
        <div class="achievement-text">
          <div class="achievement-name">${achievement.name}</div>
          <div class="achievement-desc">${achievement.desc}</div>
          <div class="achievement-xp">+${achievement.xp} XP</div>
        </div>
      </div>
    `;
    
    document.body.appendChild(popup);
    setTimeout(() => popup.remove(), 3000);
  }

  createConfetti() {
    for (let i = 0; i < 20; i++) {
      setTimeout(() => {
        const confetti = document.createElement('div');
        confetti.className = 'confetti';
        confetti.style.cssText = `
          position: fixed;
          width: 8px;
          height: 8px;
          background: ${this.getRandomDarkColor()};
          top: -10px;
          left: ${Math.random() * 100}vw;
          border-radius: 2px;
          animation: fall ${Math.random() * 2 + 1}s linear forwards;
          z-index: 10000;
        `;
        document.body.appendChild(confetti);
        setTimeout(() => confetti.remove(), 2000);
      }, i * 50);
    }
  }

  getRandomDarkColor() {
    const colors = ['#dc2626', '#059669', '#7c3aed', '#d97706', '#0e7490', '#4b5563'];
    return colors[Math.floor(Math.random() * colors.length)];
  }

  async saveAchievementToSheets(achievementKey, userStats) {
    const data = {
      type: 'achievement',
      timestamp: new Date().toISOString(),
      studentName: `${currentUser.name} ${currentUser.surname}`,
      achievement: achievementKey,
      xpEarned: this.achievements[achievementKey].xp,
      totalXP: userStats.totalXP
    };
    await sendToGoogleSheets(data);
  }
}

// ğŸ”¥ VERÄ° SENKRONÄ°ZASYON SÄ°STEMÄ° - GÃœNCELLENDÄ°
class UniversalDataSync {
  constructor() {
    this.APPS_SCRIPT_URL = APPS_SCRIPT_URL;
  }

  async syncAllData() {
    showSyncStatus('ğŸ”„ TÃ¼m veriler senkronize ediliyor...', 'sending');
    
    // 1. Ã–NCE VERÄ°LERÄ° GÃ–NDER
    const allData = {
      timestamp: new Date().toISOString(),
      type: 'full_sync',
      exams: exams,
      homeworks: homeworks,
      hadises: hadises,
      students: students,
      examTopics: examTopics,
      userStats: userStats,
      notes: notes,
      currentUser: currentUser
    };

    try {
      // Ã–NCE GÃ–NDER
      await sendToGoogleSheets(allData);
      showSyncStatus('âœ… Veriler gÃ¶nderildi, ÅŸimdi alÄ±nÄ±yor...', 'sending');
      
      // 2. SONRA VERÄ°LERÄ° AL
      await this.fetchAndProcessData();
      
      showSyncStatus('âœ… TÃ¼m veriler baÅŸarÄ±yla senkronize edildi!', 'success');
      setTimeout(() => {
        const status = document.getElementById('sendStatus');
        if (status) status.innerHTML = '';
      }, 3000);
    } catch (error) {
      showSyncStatus('âŒ Senkronizasyon hatasÄ±!', 'error');
    }
  }

  async fetchAndProcessData() {
    try {
      console.log('ğŸ“¥ Google Sheets verisi Ã§ekiliyor...', CSV_URL);
      
      const response = await fetch(CSV_URL);
      
      if (!response.ok) {
        throw new Error(`HTTP error! status: ${response.status}`);
      }
      
      const csvText = await response.text();
      console.log('ğŸ“„ CSV AlÄ±ndÄ±:', csvText.substring(0, 200));
      
      const sheetData = this.parseCSVData(csvText);
      this.processSheetData(sheetData);
      
      console.log('âœ… Google Sheets verisi iÅŸlendi:', sheetData);
      return sheetData;
    } catch (error) {
      console.error('âŒ Google Sheets verisi alÄ±namadÄ±:', error);
      return null;
    }
  }

  parseCSVData(csvText) {
    if (!csvText) return [];
    const lines = csvText.split(/\r\n|\n/);
    if (lines.length < 2) return [];

    const separator = (csvText.indexOf('\t') !== -1) ? '\t' : ',';
    const headers = lines[0].split(separator).map(header => header.trim().toLowerCase());

    const result = [];
    
    for (let i = 1; i < lines.length; i++) {
      if (!lines[i].trim()) continue;
      const values = lines[i].split(separator);
      const rowData = {};
      let isEmptyRow = true;

      headers.forEach((header, index) => {
        const value = values[index] ? values[index].trim() : '';
        rowData[header] = value;
        if (value) isEmptyRow = false;
      });

      if (!isEmptyRow) {
        result.push(rowData);
      }
    }
    return result;
  }

  processSheetData(sheetData) {
    if (!sheetData || sheetData.length === 0) return;

    console.log('ğŸ”„ Sheets verisi iÅŸleniyor...', sheetData);

    // SINAVLAR - SADECE YENÄ° EKLENENLERÄ° AL, SÄ°LÄ°NENLER KALDIRILDI
    const sheetExams = sheetData.filter(row => row.type === 'exam').map(row => ({
      id: parseInt(row.id) || Date.now() + Math.random(),
      title: row.title || '',
      desc: row.desc || '',
      date: row.date || null,
      importance: parseInt(row.importance) || 3
    }));

    // Ã–DEVLER - SADECE YENÄ° EKLENENLERÄ° AL
    const sheetHomeworks = sheetData.filter(row => row.type === 'homework').map(row => ({
      id: parseInt(row.id) || Date.now() + Math.random(),
      title: row.title || '',
      desc: row.desc || '',
      date: row.date || null,
      importance: parseInt(row.importance) || null
    }));

    // HADÄ°SLER - SADECE YENÄ° EKLENENLERÄ° AL
    const sheetHadises = sheetData.filter(row => row.type === 'hadis').map(row => ({
      id: parseInt(row.id) || Date.now() + Math.random(),
      title: row.title || '',
      desc: row.desc || '',
      date: row.date || null,
      importance: parseInt(row.importance) || null
    }));

    // Ã–ÄRENCÄ°LER - SADECE YENÄ° EKLENENLERÄ° AL
    const sheetStudents = sheetData.filter(row => row.type === 'student').map(row => ({
      name: row.name || '',
      surname: row.surname || '',
      joinDate: row.joindate || new Date().toLocaleString('tr-TR'),
      joinTimestamp: parseInt(row.jointimestamp) || Date.now()
    }));

    // LÄ°DERLÄ°K VERÄ°LERÄ° - MEVCUT VERÄ°LERLE BÄ°RLEÅTÄ°R
    const sheetLeaders = sheetData.filter(row => row.type === 'leaderboard').map(row => ({
      name: row.name || '',
      surname: row.surname || '',
      totalXP: parseInt(row.totalxp) || 0,
      totalStudyTime: parseInt(row.totalstudytime) || 0,
      monthlyXP: parseInt(row.monthlyxp) || 0,
      monthlyStudyTime: parseInt(row.monthlystudytime) || 0,
      level: parseInt(row.level) || 1,
      currentStreak: parseInt(row.currentstreak) || 0
    }));

    // VERÄ°LERÄ° GÃœNCELLE - SADECE YENÄ° EKLENENLER
    if (sheetExams.length > 0) {
      // Mevcut exam ID'lerini al
      const existingExamIds = exams.map(exam => exam.id);
      // Sadece yeni exam'larÄ± ekle (ID'si olmayanlar veya farklÄ± ID'ler)
      const newExams = sheetExams.filter(exam => !existingExamIds.includes(exam.id));
      exams = [...exams, ...newExams];
      localStorage.setItem('exams', JSON.stringify(exams));
    }
    
    if (sheetHomeworks.length > 0) {
      const existingHomeworkIds = homeworks.map(hw => hw.id);
      const newHomeworks = sheetHomeworks.filter(hw => !existingHomeworkIds.includes(hw.id));
      homeworks = [...homeworks, ...newHomeworks];
      localStorage.setItem('homeworks', JSON.stringify(homeworks));
    }
    
    if (sheetHadises.length > 0) {
      const existingHadisIds = hadises.map(hd => hd.id);
      const newHadises = sheetHadises.filter(hd => !existingHadisIds.includes(hd.id));
      hadises = [...hadises, ...newHadises];
      localStorage.setItem('hadises', JSON.stringify(hadises));
    }
    
    if (sheetStudents.length > 0) {
      const existingStudentKeys = students.map(s => `${s.name}_${s.surname}`);
      const newStudents = sheetStudents.filter(s => !existingStudentKeys.includes(`${s.name}_${s.surname}`));
      students = [...students, ...newStudents];
      localStorage.setItem('students', JSON.stringify(students));
    }

    // USER STATS GÃœNCELLE
    if (sheetLeaders.length > 0) {
      sheetLeaders.forEach(leader => {
        const userKey = `${leader.name}_${leader.surname}`;
        if (!userStats[userKey]) {
          userStats[userKey] = {
            monthlyXP: 0,
            monthlyStudyTime: 0,
            monthlySessions: 0,
            totalXP: 0,
            totalStudyTime: 0,
            totalSessions: 0,
            level: 1,
            currentStreak: 0,
            longestStreak: 0,
            lastStudyDate: null,
            joinDate: new Date().toLocaleString('tr-TR'),
            lastActive: new Date().toLocaleString('tr-TR')
          };
        }
        
        // Sadece daha yÃ¼ksek deÄŸerler varsa gÃ¼ncelle
        if (leader.totalXP > userStats[userKey].totalXP) {
          userStats[userKey].totalXP = leader.totalXP;
        }
        if (leader.totalStudyTime > userStats[userKey].totalStudyTime) {
          userStats[userKey].totalStudyTime = leader.totalStudyTime;
        }
        if (leader.monthlyXP > userStats[userKey].monthlyXP) {
          userStats[userKey].monthlyXP = leader.monthlyXP;
        }
        if (leader.monthlyStudyTime > userStats[userKey].monthlyStudyTime) {
          userStats[userKey].monthlyStudyTime = leader.monthlyStudyTime;
        }
        if (leader.level > userStats[userKey].level) {
          userStats[userKey].level = leader.level;
        }
        if (leader.currentStreak > userStats[userKey].currentStreak) {
          userStats[userKey].currentStreak = leader.currentStreak;
        }
      });
      
      localStorage.setItem('userStats', JSON.stringify(userStats));
    }

    this.updateUI();
  }

  updateUI() {
    if (window.renderExams) renderExams();
    if (window.renderHomeworks) renderHomeworks();
    if (window.renderHadis) renderHadis();
    if (window.renderClass) renderClass();
    if (window.renderUpcoming) renderUpcoming();
    if (window.renderLeaderboards) renderLeaderboards();
    if (window.updatePomodoroStats) updatePomodoroStats();
  }

  async syncPomodoroData() {
    if (!currentUser) {
      showSyncStatus('âŒ Ã–nce giriÅŸ yapÄ±n!', 'error', 'pomodoroSendStatus');
      return;
    }
    
    const userKey = `${currentUser.name}_${currentUser.surname}`;
    const stats = userStats[userKey];
    
    if (!stats || stats.totalXP === 0) {
      showSyncStatus('âŒ GÃ¶nderilecek Pomodoro verisi yok!', 'error', 'pomodoroSendStatus');
      return;
    }

    showSyncStatus('â³ Pomodoro verileri senkronize ediliyor...', 'sending', 'pomodoroSendStatus');
    
    const pomodoroData = {
      type: 'pomodoro_sync',
      timestamp: new Date().toISOString(),
      studentName: `${currentUser.name} ${currentUser.surname}`,
      totalXP: stats.totalXP || 0,
      totalStudyTime: stats.totalStudyTime || 0,
      monthlyXP: stats.monthlyXP || 0,
      monthlyStudyTime: stats.monthlyStudyTime || 0,
      level: stats.level || 1,
      currentStreak: stats.currentStreak || 0
    };

    try {
      await sendToGoogleSheets(pomodoroData);
      showSyncStatus('âœ… Pomodoro verileri senkronize edildi!', 'success', 'pomodoroSendStatus');
    } catch (error) {
      showSyncStatus('âŒ Pomodoro senkronizasyon hatasÄ±!', 'error', 'pomodoroSendStatus');
    }
  }
}

// ğŸ”¥ GOOGLE SHEETS ENTEGRASYONU
async function sendToGoogleSheets(data) {
  try {
    await fetch(APPS_SCRIPT_URL, {
      method: 'POST',
      body: JSON.stringify(data),
      mode: 'no-cors'
    });
    console.log('ğŸ“¤ Veri Sheets\'e gÃ¶nderildi:', data.type);
    return true;
  } catch (error) {
    console.log('âš ï¸ GÃ¶nderim tamamlandÄ±');
    return true;
  }
}

// POMODORO SÄ°STEMÄ° (MEVCUT)
function startTimer() {
  if (isRunning) return;
  
  isRunning = true;
  const startPomodoro = document.getElementById('startPomodoro');
  const pausePomodoro = document.getElementById('pausePomodoro');
  
  if (startPomodoro) startPomodoro.disabled = true;
  if (pausePomodoro) pausePomodoro.disabled = false;
  
  startTime = Date.now();
  earnedXP = 0;
  
  pomodoroInterval = setInterval(() => {
    currentTime--;
    updateTimerDisplay();
    
    if (startTime) {
      const elapsedSeconds = Math.floor((Date.now() - startTime) / 1000);
      earnedXP = elapsedSeconds / 60;
    }
    
    if (currentTime <= 0) {
      completeSession();
    }
  }, 1000);
}

function pauseTimer() {
  if (!isRunning) return;
  isRunning = false;
  clearInterval(pomodoroInterval);
  
  const startPomodoro = document.getElementById('startPomodoro');
  const pausePomodoro = document.getElementById('pausePomodoro');
  
  if (startPomodoro) startPomodoro.disabled = false;
  if (pausePomodoro) pausePomodoro.disabled = true;
}
// Eksik fonksiyonu ekleyelim
function saveEarnedXP() {
  if (earnedXP <= 0 || !currentUser) return;
  
  const userKey = `${currentUser.name}_${currentUser.surname}`;
  if (!userStats[userKey]) {
    userStats[userKey] = {
      monthlyXP: 0, monthlyStudyTime: 0, monthlySessions: 0,
      totalXP: 0, totalStudyTime: 0, totalSessions: 0,
      level: 1, currentStreak: 0, longestStreak: 0,
      lastStudyDate: null, joinDate: new Date().toLocaleString('tr-TR'),
      lastActive: new Date().toLocaleString('tr-TR'),
      unlockedAchievements: [],
      earlySessions: 0, nightSessions: 0, weekendSessions: 0,
      fastSessions: 0, longestSession: 0
    };
  }
  
  // XP ve sÃ¼reyi gÃ¼ncelle
  userStats[userKey].monthlyXP += earnedXP;
  userStats[userKey].totalXP += earnedXP;
  userStats[userKey].totalStudyTime += earnedXP; // 1 XP = 1 dakika
  
  localStorage.setItem('userStats', JSON.stringify(userStats));
  updatePomodoroStats();
  updateQuickStats();
  
  console.log(`ğŸ’¾ XP kaydedildi: +${earnedXP.toFixed(2)} XP`);
}

// resetTimer fonksiyonunu da gÃ¼ncelleyelim
function resetTimer() {
  // ZamanlayÄ±cÄ±yÄ± durdur
  if (pomodoroInterval) {
    clearInterval(pomodoroInterval);
    pomodoroInterval = null;
  }
  
  isRunning = false;
  
  // 1 saniye bile Ã§alÄ±ÅŸÄ±ldÄ±ysa XP kaydet
  if (earnedXP > 0) {
    saveEarnedXP();
  }
  
  // ZamanÄ± seÃ§ilen sÃ¼reye sÄ±fÄ±rla
  currentTime = selectedTime * 60;
  updateTimerDisplay();
  
  // Buton durumlarÄ±nÄ± sÄ±fÄ±rla
  const startPomodoro = document.getElementById('startPomodoro');
  const pausePomodoro = document.getElementById('pausePomodoro');
  
  if (startPomodoro) {
    startPomodoro.disabled = false;
    startPomodoro.textContent = 'BaÅŸlat';
  }
  
  if (pausePomodoro) {
    pausePomodoro.disabled = true;
    pausePomodoro.textContent = 'Duraklat';
  }
  
  // KazanÄ±lan XP'yi sÄ±fÄ±rla
  earnedXP = 0;
  startTime = null;
  
  console.log('âœ… Pomodoro sÄ±fÄ±rlandÄ±!');
}

function completeSession() {
  pauseTimer();
  if (!currentUser) return;
  
  const userKey = `${currentUser.name}_${currentUser.surname}`;
  if (!userStats[userKey]) {
    userStats[userKey] = {
      monthlyXP: 0, monthlyStudyTime: 0, monthlySessions: 0,
      totalXP: 0, totalStudyTime: 0, totalSessions: 0,
      level: 1, currentStreak: 0, longestStreak: 0,
      lastStudyDate: null, joinDate: new Date().toLocaleString('tr-TR'),
      lastActive: new Date().toLocaleString('tr-TR'),
      unlockedAchievements: [],
      earlySessions: 0, nightSessions: 0, weekendSessions: 0,
      fastSessions: 0, longestSession: 0
    };
  }
  
  const now = new Date();
  const hour = now.getHours();
  const day = now.getDay();
  
  userStats[userKey].monthlyStudyTime += selectedTime;
  userStats[userKey].monthlySessions += 1;
  userStats[userKey].monthlyXP += selectedTime;
  userStats[userKey].totalStudyTime += selectedTime;
  userStats[userKey].totalSessions += 1;
  userStats[userKey].totalXP += selectedTime;
  
  if (hour < 7) userStats[userKey].earlySessions += 1;
  if (hour >= 23) userStats[userKey].nightSessions += 1;
  if (day === 0 || day === 6) userStats[userKey].weekendSessions += 1;
  if (selectedTime < 30) userStats[userKey].fastSessions += 1;
  
  if (selectedTime > userStats[userKey].longestSession) {
    userStats[userKey].longestSession = selectedTime;
  }
  
  updateStreak();
  
  const newLevel = Math.floor(userStats[userKey].totalXP / 250) + 1;
  if (newLevel > userStats[userKey].level) {
    userStats[userKey].level = newLevel;
    alert(`ğŸ‰ Tebrikler! Seviye ${newLevel} oldunuz! ğŸ‰`);
  }
  
  achievementSystem.checkAchievements(userStats[userKey]);
  localStorage.setItem('userStats', JSON.stringify(userStats));
  updatePomodoroStats();
  updateQuickStats();
  
  setTimeout(() => dataSync.syncPomodoroData(), 1000);
  alert(`ğŸ¯ Oturum tamamlandÄ±! +${selectedTime} XP\nToplam: ${userStats[userKey].totalXP} XP`);
  resetTimer();
}

function updateStreak() {
  if (!currentUser) return;
  const userKey = `${currentUser.name}_${currentUser.surname}`;
  const stats = userStats[userKey];
  if (!stats) return;
  
  stats.currentStreak = (stats.currentStreak || 0) + 1;
  if (stats.currentStreak > (stats.longestStreak || 0)) {
    stats.longestStreak = stats.currentStreak;
  }
  localStorage.setItem('userStats', JSON.stringify(userStats));
}

// DÄ°ÄER MEVCUT FONKSÄ°YONLAR...
function escapeHtml(text){
  if (!text) return '';
  return text.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");
}

function isItemUrgent(date){
  if(!date) return false; 
  const now = new Date(); 
  const diff = (new Date(date) - now) / (1000 * 60 * 60 * 24); 
  return diff >= 0 && diff <= 1;
}

function sortExams(examsToSort, sortType) {
  const sorted = [...examsToSort];
  switch(sortType) {
    case "importance-date":
      return sorted.sort((a, b) => {
        const importanceDiff = (b.importance || 3) - (a.importance || 3);
        if (importanceDiff !== 0) return importanceDiff;
        const dateA = a.date ? new Date(a.date) : new Date(0);
        const dateB = b.date ? new Date(b.date) : new Date(0);
        return dateA - dateB;
      });
    case "date":
      return sorted.sort((a, b) => {
        const dateA = a.date ? new Date(a.date) : new Date(0);
        const dateB = b.date ? new Date(b.date) : new Date(0);
        return dateA - dateB;
      });
    case "importance":
      return sorted.sort((a, b) => (b.importance || 3) - (a.importance || 3));
    default:
      return sorted;
  }
}

// RENDER FONKSÄ°YONLARI
function renderExams(){
  const list = document.getElementById('examList'); 
  if(!list) return;
  
  if(exams.length===0){
    list.innerHTML='<div class="card"><p>HenÃ¼z sÄ±nav eklenmedi.</p></div>'; 
    return;
  }
  
  const sortedExams = sortExams(exams, examSortType);
  list.innerHTML = sortedExams.map(exam => {
    const imp = importanceLevels[exam.importance||3];
    const urgent = isItemUrgent(exam.date);
    
    return `
      <div class="card ${urgent?'urgent-card':''}">
        ${isAdmin?`<button class="delete-btn" onclick="deleteItem('exam',${exam.id})"><i class="fas fa-times"></i></button>`:''}
        <h3>${escapeHtml(exam.title)} <span class="importance-badge ${imp.class}">${imp.icon} ${imp.label}</span>${urgent?'<span style="color:var(--accent-danger);margin-left:8px;">ğŸš¨ SON GÃœN!</span>':''}</h3>
        <p>${escapeHtml(exam.desc)}</p>
        <p><strong>Tarih:</strong> ${exam.date?new Date(exam.date).toLocaleString('tr-TR'):'-'}</p>
      </div>
    `;
  }).join('');
  localStorage.setItem('exams',JSON.stringify(exams));
}

function renderHomeworks(){
  const list=document.getElementById('homeworkList'); 
  if(!list) return;
  
  if(homeworks.length===0){
    list.innerHTML='<div class="card"><p>HenÃ¼z Ã¶dev eklenmedi.</p></div>'; 
    return;
  }
  
  const sortedHomeworks = [...homeworks].sort((a, b) => {
    const dateA = a.date ? new Date(a.date) : new Date(0);
    const dateB = b.date ? new Date(b.date) : new Date(0);
    return dateA - dateB;
  });
  
  list.innerHTML=sortedHomeworks.map(hw=>{
    const imp = hw.importance ? importanceLevels[hw.importance] : null;
    const urgent=isItemUrgent(hw.date);
    return `<div class="card ${urgent?'urgent-card':''}">
      ${isAdmin?`<button class="delete-btn" onclick="deleteItem('homework',${hw.id})"><i class="fas fa-times"></i></button>`:''}
      <h3>${escapeHtml(hw.title)} ${imp ? `<span class="importance-badge ${imp.class}">${imp.icon} ${imp.label}</span>` : ''}${urgent?'<span style="color:var(--accent-danger);margin-left:8px;">ğŸš¨ SON GÃœN!</span>':''}</h3>
      <p>${escapeHtml(hw.desc)}</p>
      <p><strong>Teslim Tarihi:</strong> ${hw.date?new Date(hw.date).toLocaleString('tr-TR'):'-'}</p>
    </div>`;
  }).join('');
  localStorage.setItem('homeworks',JSON.stringify(homeworks));
}

function renderHadis(){
  const list=document.getElementById('hadisList'); 
  if(!list) return;
  if(hadises.length===0){
    list.innerHTML='<div class="card"><p>HenÃ¼z hadis eklenmedi.</p></div>'; 
    return;
  }
  list.innerHTML=hadises.map(hd=>{
    const imp = hd.importance ? importanceLevels[hd.importance] : null;
    return `<div class="card">
      ${isAdmin?`<button class="delete-btn" onclick="deleteItem('hadis',${hd.id})"><i class="fas fa-times"></i></button>`:''}
      <h3>${escapeHtml(hd.title)} ${imp ? `<span class="importance-badge ${imp.class}">${imp.icon} ${imp.label}</span>` : ''}</h3>
      <p>${escapeHtml(hd.desc)}</p>
    </div>`;
  }).join('');
  localStorage.setItem('hadises',JSON.stringify(hadises));
}

function renderClass(){
  const list=document.getElementById('classList'); 
  if(!list) return;
  if(students.length===0){
    list.innerHTML='<p>SÄ±nÄ±f listesi henÃ¼z oluÅŸturulmadÄ±.</p>'; 
    return;
  }
  
  const sorted=[...students].sort((a,b)=>(b.joinTimestamp||0)-(a.joinTimestamp||0));
  list.innerHTML=sorted.map((s,i)=>{
    const userKey = `${s.name}_${s.surname}`;
    const stats = userStats[userKey] || { 
      level: 1, totalXP: 0, totalStudyTime: 0, monthlyXP: 0,
      currentStreak: 0, longestStreak: 0
    };
    
    const level = stats.level || 1;
    const totalXP = stats.totalXP || 0;
    const streak = stats.currentStreak || 0;
    const longestStreak = stats.longestStreak || 0;
    const streakColor = getStreakColor(streak);
    
    return `
      <div class="student-item">
        <strong>${i+1}. ${escapeHtml(s.name)} ${escapeHtml(s.surname)} 
          <span class="student-level">Seviye ${level}</span>
        </strong>
        <div style="display: flex; align-items: center; gap: 8px; margin-top: 6px;">
          <div style="background: ${streakColor}; padding: 4px 10px; border-radius: 12px; font-size: 0.8rem; font-weight: bold; color: white; display: flex; align-items: center; gap: 4px;">
            ğŸ”¥ ${streak}
          </div>
          <small style="color:#94a3b8;">
            ${Math.floor(totalXP)} XP â€¢ ${longestStreak} En Uzun
          </small>
        </div>
      </div>
    `;
  }).join('');
}

function renderUpcoming(){
  const list=document.getElementById('upcomingList'); 
  if(!list) return;
  const now=new Date(); 
  let upcoming=[];
  exams.forEach(e=>{
    if(e.date){
      const diff=(new Date(e.date)-now)/(1000*60*60*24); 
      if(diff>=0&&diff<=2) upcoming.push({type:"SÄ±nav",title:e.title,date:e.date,importance:e.importance});
    }
  });
  homeworks.forEach(h=>{
    if(h.date){
      const diff=(new Date(h.date)-now)/(1000*60*60*24); 
      if(diff>=0&&diff<=2) upcoming.push({type:"Ã–dev",title:h.title,date:h.date,importance:h.importance});
    }
  });
  if(upcoming.length===0){
    list.innerHTML='<li>YaklaÅŸan sÄ±nav veya Ã¶dev bulunmamaktadÄ±r.</li>'; 
    return;
  }
  list.innerHTML=upcoming.map(item=>{
    const imp = item.importance ? importanceLevels[item.importance] : null;
    return `<li><strong>${item.type}:</strong> ${escapeHtml(item.title)} ${imp ? `<span class="importance-badge ${imp.class}">${imp.icon}</span>` : ''} <small>(${new Date(item.date).toLocaleString('tr-TR')})</small></li>`;
  }).join('');
}

function renderLeaderboards() {
  renderMonthlyLeaderboard();
  renderTotalLeaderboard();
}

function renderMonthlyLeaderboard() {
  const monthlyLeaderboard = document.getElementById('monthlyLeaderboard');
  if (!monthlyLeaderboard) return;
  
  const sortedUsers = Object.entries(userStats)
    .map(([userKey, stats]) => {
      const [name, surname] = userKey.split('_');
      return {
        name, surname,
        monthlyXP: stats.monthlyXP || 0,
        monthlyStudyTime: stats.monthlyStudyTime || 0,
        level: stats.level || 1,
        currentStreak: stats.currentStreak || 0,
        totalXP: stats.totalXP || 0
      };
    })
    .sort((a, b) => b.monthlyXP - a.monthlyXP)
    .filter(user => user.monthlyXP > 0 || user.totalXP > 0);
  
  if (sortedUsers.length === 0) {
    monthlyLeaderboard.innerHTML = '<p>HenÃ¼z aylÄ±k liderlik verisi yok.</p>';
    return;
  }
  
  monthlyLeaderboard.innerHTML = sortedUsers.map((user, index) => {
    const rank = index + 1;
    let medal = '';
    if (rank === 1) medal = 'ğŸ¥‡';
    else if (rank === 2) medal = 'ğŸ¥ˆ';
    else if (rank === 3) medal = 'ğŸ¥‰';
    
    const streakColor = getStreakColor(user.currentStreak);
    
    return `
      <div class="leaderboard-item">
        <div class="leaderboard-rank">${rank}</div>
        <div class="leaderboard-info">
          <div class="leaderboard-name">${escapeHtml(user.name)} ${escapeHtml(user.surname)} 
            <span style="background: ${streakColor}; padding: 2px 8px; border-radius: 10px; font-size: 0.7rem; color: white;">ğŸ”¥ ${user.currentStreak}</span>
          </div>
          <div class="leaderboard-level">${Math.floor(user.monthlyXP)} XP â€¢ ${Math.floor(user.monthlyStudyTime)} dakika</div>
        </div>
        <div class="leaderboard-xp">${medal}</div>
      </div>
    `;
  }).join('');
}

function renderTotalLeaderboard() {
  const totalLeaderboard = document.getElementById('totalLeaderboard');
  if (!totalLeaderboard) return;
  
  const sortedUsers = Object.entries(userStats)
    .map(([userKey, stats]) => {
      const [name, surname] = userKey.split('_');
      return {
        name, surname,
        totalXP: stats.totalXP || 0,
        totalStudyTime: stats.totalStudyTime || 0,
        level: stats.level || 1,
        currentStreak: stats.currentStreak || 0
      };
    })
    .sort((a, b) => b.totalXP - a.totalXP)
    .filter(user => user.totalXP > 0);
  
  if (sortedUsers.length === 0) {
    totalLeaderboard.innerHTML = '<p>HenÃ¼z toplam liderlik verisi yok.</p>';
    return;
  }
  
  totalLeaderboard.innerHTML = sortedUsers.map((user, index) => {
    const rank = index + 1;
    let medal = '';
    if (rank === 1) medal = 'â­';
    else if (rank === 2) medal = 'ğŸŒŸ';
    else if (rank === 3) medal = 'âœ¨';
    
    const streakColor = getStreakColor(user.currentStreak);
    
    return `
      <div class="leaderboard-item">
        <div class="leaderboard-rank">${rank}</div>
        <div class="leaderboard-info">
          <div class="leaderboard-name">${escapeHtml(user.name)} ${escapeHtml(user.surname)} 
            <span class="total-badge">Seviye ${user.level}</span>
            <span style="background: ${streakColor}; padding: 2px 8px; border-radius: 10px; font-size: 0.7rem; color: white;">ğŸ”¥ ${user.currentStreak}</span>
          </div>
          <div class="leaderboard-level">${Math.floor(user.totalXP)} XP â€¢ ${Math.floor(user.totalStudyTime)} dakika</div>
        </div>
        <div class="leaderboard-xp">${medal}</div>
      </div>
    `;
  }).join('');
}

function renderProfile() {
  if (!currentUser) return;
  
  const userKey = `${currentUser.name}_${currentUser.surname}`;
  const stats = userStats[userKey] || {};
  
  const totalXP = stats.totalXP || 0;
  const level = stats.level || 1;
  const currentLevelXP = totalXP % 250;
  const progressPercentage = Math.min(100, (currentLevelXP / 250) * 100);
  
  document.getElementById('profileName').textContent = `${currentUser.name} ${currentUser.surname}`;
  document.getElementById('profileLevel').textContent = `Seviye ${level}`;
  document.getElementById('profileTotalXP').textContent = Math.floor(totalXP);
  document.getElementById('profileStudyTime').textContent = Math.floor(stats.totalStudyTime || 0);
  document.getElementById('profileSessions').textContent = stats.totalSessions || 0;
  document.getElementById('profileStreak').textContent = stats.currentStreak || 0;
  document.getElementById('profileProgress').style.width = `${progressPercentage}%`;
  document.getElementById('profileNextLevel').textContent = Math.max(0, 250 - currentLevelXP);
  document.getElementById('monthlyXP').textContent = Math.floor(stats.monthlyXP || 0);
  document.getElementById('monthlyStudyTime').textContent = Math.floor(stats.monthlyStudyTime || 0);
  document.getElementById('monthlySessions').textContent = stats.monthlySessions || 0;
}

function renderAchievements() {
  const list = document.getElementById('achievementsList');
  if (!list) return;
  
  if (!currentUser) {
    list.innerHTML = '<div class="card"><p>BaÅŸarÄ±mlarÄ± gÃ¶rmek iÃ§in giriÅŸ yapÄ±n.</p></div>';
    return;
  }
  
  const userKey = `${currentUser.name}_${currentUser.surname}`;
  const stats = userStats[userKey] || {};
  const unlocked = stats.unlockedAchievements || [];
  
  const totalAchievements = Object.keys(achievementSystem.achievements).length;
  const unlockedCount = unlocked.length;
  const completionRate = Math.round((unlockedCount / totalAchievements) * 100);
  const achievementXP = unlocked.reduce((total, key) => total + (achievementSystem.achievements[key]?.xp || 0), 0);
  
  document.getElementById('totalAchievements').textContent = unlockedCount;
  document.getElementById('achievementXP').textContent = achievementXP;
  document.getElementById('completionRate').textContent = completionRate + '%';
  
  list.innerHTML = Object.keys(achievementSystem.achievements).map(key => {
    const achievement = achievementSystem.achievements[key];
    const isUnlocked = unlocked.includes(key);
    
    return `
      <div class="achievement-card ${isUnlocked ? 'unlocked' : 'locked'}">
        <div class="achievement-icon-large">${achievement.icon}</div>
        <h4>${achievement.name}</h4>
        <p>${achievement.desc}</p>
        <div class="achievement-xp">+${achievement.xp} XP</div>
        <div class="achievement-status">${isUnlocked ? 'âœ… KazanÄ±ldÄ±' : 'ğŸ”’ Kilitli'}</div>
      </div>
    `;
  }).join('');
}

// ğŸ”¥ YENÄ° NOT SÄ°STEMÄ°
function renderNotes() {
  const list = document.getElementById('notesList');
  if (!list) return;
  
  // Sadece kendi notlarÄ±nÄ± gÃ¶ster
  const userNotes = notes.filter(note => note.userKey === `${currentUser.name}_${currentUser.surname}`);
  
  if (userNotes.length === 0) {
    list.innerHTML = '<div class="card"><p>HenÃ¼z not eklenmedi.</p></div>';
    return;
  }
  
  list.innerHTML = userNotes.map(note => `
    <div class="note-card">
      <h4>${escapeHtml(note.title)}</h4>
      <div class="note-content">${escapeHtml(note.content)}</div>
      <div class="note-date">${new Date(note.createdAt).toLocaleDateString('tr-TR')}</div>
      <button class="delete-btn" onclick="deleteNote(${note.id})"><i class="fas fa-times"></i></button>
    </div>
  `).join('');
}

// YARDIMCI FONKSÄ°YONLAR
function getStreakColor(streak) {
  if (streak >= 90) return streakColors[90];
  if (streak >= 60) return streakColors[60];
  if (streak >= 30) return streakColors[30];
  if (streak >= 14) return streakColors[14];
  if (streak >= 7) return streakColors[7];
  if (streak >= 3) return streakColors[3];
  return streakColors[1];
}

function updateQuickStats() {
  if (!currentUser) return;
  const userKey = `${currentUser.name}_${currentUser.surname}`;
  const stats = userStats[userKey];
  
  if (stats) {
    const quickXP = document.getElementById('quickXP');
    const quickLevel = document.getElementById('quickLevel');
    const quickStreak = document.getElementById('quickStreak');
    const quickStudyTime = document.getElementById('quickStudyTime');
    
    if (quickXP) quickXP.textContent = Math.floor(stats.totalXP || 0);
    if (quickLevel) quickLevel.textContent = stats.level || 1;
    if (quickStreak) quickStreak.textContent = stats.currentStreak || 0;
    if (quickStudyTime) quickStudyTime.textContent = Math.floor(stats.totalStudyTime || 0);
  }
}

function showSyncStatus(message, type = 'info', elementId = 'sendStatus') {
  const statusEl = document.getElementById(elementId);
  if (statusEl) {
    statusEl.innerHTML = `<div class="status-message status-${type}">${message}</div>`;
  }
}

function showCurrentData() {
  const dataEl = document.getElementById('currentData');
  if (!dataEl) return;
  
  const users = Object.entries(userStats)
    .map(([userKey, stats]) => {
      const [name, surname] = userKey.split('_');
      return { name, surname, totalXP: stats.totalXP || 0, totalStudyTime: stats.totalStudyTime || 0 };
    })
    .filter(user => user.totalXP > 0);
  
  if (users.length === 0) {
    dataEl.innerHTML = '<p>HenÃ¼z veri bulunmuyor.</p>';
    return;
  }
  
  dataEl.innerHTML = users.map(user => `
    <div style="background:rgba(255,255,255,0.05); padding:10px; margin:5px 0; border-radius:8px;">
      <strong>${user.name} ${user.surname}</strong><br>
      <small>XP: ${Math.floor(user.totalXP)} | SÃ¼re: ${Math.floor(user.totalStudyTime)} dk</small>
    </div>
  `).join('');
}

// ğŸ”¥ YENÄ° NOT MODAL FONKSÄ°YONU
function showAddNoteModal() {
  if (!currentUser) {
    alert('LÃ¼tfen Ã¶nce giriÅŸ yapÄ±n!');
    document.getElementById('loginModal').style.display = 'flex';
    return;
  }
  
  document.getElementById('addNoteModal').style.display = 'flex';
  document.getElementById('noteTitle').value = '';
  document.getElementById('noteContent').value = '';
  document.querySelectorAll('.note-category').forEach(cat => cat.classList.remove('active'));
  document.querySelector('.note-category[data-category="study"]').classList.add('active');
}

// ğŸ”¥ SÄ°LME FONKSÄ°YONLARI - GÃœNCELLENDÄ°
function deleteItem(type, id) {
  if (!isAdmin) {
    alert('Sadece admin silme iÅŸlemi yapabilir!');
    return;
  }
  
  if (type === "exam") {
    exams = exams.filter(e => e.id !== id);
    examTopics = examTopics.filter(topic => topic.examId !== id);
    localStorage.setItem('examTopics', JSON.stringify(examTopics));
    renderExams();
  } else if (type === "homework") {
    homeworks = homeworks.filter(h => h.id !== id);
    renderHomeworks();
  } else if (type === "hadis") {
    hadises = hadises.filter(h => h.id !== id);
    renderHadis();
  }
  
  renderUpcoming();
  localStorage.setItem('exams', JSON.stringify(exams));
  localStorage.setItem('homeworks', JSON.stringify(homeworks));
  localStorage.setItem('hadises', JSON.stringify(hadises));
  
  // ğŸ”¥ SÄ°LÄ°NDÄ° BÄ°LGÄ°SÄ°NÄ° GÃ–NDER (GERÄ° GELMEMESÄ° Ä°Ã‡Ä°N)
  const deleteData = {
    type: 'delete',
    timestamp: new Date().toISOString(),
    itemType: type,
    itemId: id,
    studentName: `${currentUser.name} ${currentUser.surname}`
  };
  
  setTimeout(() => sendToGoogleSheets(deleteData), 1000);
}

function deleteNote(id) {
  notes = notes.filter(note => note.id !== id);
  localStorage.setItem('notes', JSON.stringify(notes));
  renderNotes();
}

// SAYAÃ‡ SÄ°STEMÄ°
function startCountdown() {
  const targetDate = new Date(currentTargetDate);
  const daysEl = document.getElementById('days');
  const hoursEl = document.getElementById('hours');
  const minutesEl = document.getElementById('minutes');
  const secondsEl = document.getElementById('seconds');

  if (!daysEl || !hoursEl || !minutesEl || !secondsEl) return;
  if (countdownInterval) clearInterval(countdownInterval);

  function updateCountdown() {
    const now = new Date();
    const diff = targetDate - now;

    if (diff <= 0) {
      daysEl.textContent = "00";
      hoursEl.textContent = "00";
      minutesEl.textContent = "00";
      secondsEl.textContent = "00";
      clearInterval(countdownInterval);
      return;
    }

    const days = Math.floor(diff / (1000 * 60 * 60 * 24));
    const hours = Math.floor((diff / (1000 * 60 * 60)) % 24);
    const minutes = Math.floor((diff / (1000 * 60)) % 60);
    const seconds = Math.floor((diff / 1000) % 60);

    daysEl.textContent = days.toString().padStart(2, "0");
    hoursEl.textContent = hours.toString().padStart(2, "0");
    minutesEl.textContent = minutes.toString().padStart(2, "0");
    secondsEl.textContent = seconds.toString().padStart(2, "0");
  }

  updateCountdown();
  countdownInterval = setInterval(updateCountdown, 1000);
}

// POMODORO Ä°STATÄ°STÄ°K GÃœNCELLEME
function updatePomodoroStats() {
  if (!currentUser) return;
  const userKey = `${currentUser.name}_${currentUser.surname}`;
  const stats = userStats[userKey];
  
  const totalStudyTimeEl = document.getElementById('totalStudyTime');
  const currentLevel = document.getElementById('currentLevel');
  const currentXP = document.getElementById('currentXP');
  const currentStreakEl = document.getElementById('currentStreak');
  const xpProgress = document.getElementById('xpProgress');
  const nextLevelXP = document.getElementById('nextLevelXP');
  
  if (stats) {
    const totalXP = stats.totalXP || 0;
    const totalStudyTime = stats.totalStudyTime || 0;
    const level = stats.level || 1;
    const currentStreak = stats.currentStreak || 0;
    
    if (totalStudyTimeEl) totalStudyTimeEl.textContent = Math.floor(totalStudyTime);
    if (currentLevel) currentLevel.textContent = level;
    if (currentXP) currentXP.textContent = Math.floor(totalXP);
    if (currentStreakEl) currentStreakEl.textContent = currentStreak;
    
    const currentLevelXP = (totalXP % 250) || 0;
    const xpPercentage = Math.min(100, Math.max(0, (currentLevelXP / 250) * 100));
    if (xpProgress) xpProgress.style.width = `${xpPercentage}%`;
    if (nextLevelXP) nextLevelXP.textContent = Math.max(0, 250 - currentLevelXP);
  }
}

function updateTimerDisplay() {
  const minutes = Math.floor(currentTime / 60);
  const seconds = currentTime % 60;
  const pomodoroTimer = document.getElementById('pomodoroTimer');
  if (pomodoroTimer) {
    pomodoroTimer.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
  }
}

// SÄ°STEM BAÅLATMA
const achievementSystem = new ExtendedAchievementSystem();
const dataSync = new UniversalDataSync();

function initializeApp() {
  loadFromLocalStorage();
  
  if (currentUser) {
    document.getElementById('loginModal').style.display = 'none';
    updateUI();
  }

  renderAllComponents();
  startCountdown();
  
  console.log('ğŸš€ Ã–ÄŸrenci PortalÄ± PRO - TÃ¼m Sistemler Aktif!');
}

function loadFromLocalStorage() {
  const savedUser = localStorage.getItem('currentUser');
  const savedStudents = localStorage.getItem('students');
  const savedExams = localStorage.getItem('exams');
  const savedHomeworks = localStorage.getItem('homeworks');
  const savedHadis = localStorage.getItem('hadises');
  const savedTopics = localStorage.getItem('examTopics');
  const savedStats = localStorage.getItem('userStats');
  const savedNotes = localStorage.getItem('notes');

  if (savedUser) currentUser = JSON.parse(savedUser);
  if (savedStudents) students = JSON.parse(savedStudents);
  if (savedExams) exams = JSON.parse(savedExams);
  if (savedHomeworks) homeworks = JSON.parse(savedHomeworks);
  if (savedHadis) hadises = JSON.parse(savedHadis);
  if (savedTopics) examTopics = JSON.parse(savedTopics);
  if (savedStats) userStats = JSON.parse(savedStats);
  if (savedNotes) notes = JSON.parse(savedNotes);
}

function renderAllComponents() {
  renderExams();
  renderHomeworks();
  renderHadis();
  renderClass();
  renderUpcoming();
  updatePomodoroStats();
  renderLeaderboards();
  renderProfile();
  renderAchievements();
  renderNotes();
  showCurrentData();
  updateQuickStats();
}

function updateUI() {
  if (currentUser) {
    const userInfo = document.getElementById('userInfo');
    const userName = document.getElementById('userName');
    const welcomeMessage = document.getElementById('welcomeMessage');
    
    if (userInfo) userInfo.style.display = 'block';
    if (userName) userName.textContent = isAdmin ? "Admin" : `${currentUser.name} ${currentUser.surname}`;
    if (welcomeMessage) {
      welcomeMessage.textContent = isAdmin ? 
        `HoÅŸ geldiniz Admin!` : 
        `HoÅŸ geldiniz ${currentUser.name} ${currentUser.surname}! PortalÄ±nÄ±za hoÅŸ geldiniz.`;
    }
  }
}

// EVENT LISTENER KURULUMU
document.addEventListener('DOMContentLoaded', function() {
  // GiriÅŸ butonu
  document.getElementById('loginBtn').addEventListener('click', function() {
    const name = document.getElementById('studentName').value.trim();
    const surname = document.getElementById('studentSurname').value.trim();
    
    if (!name || !surname) {
      alert('LÃ¼tfen ad ve soyad girin!');
      return;
    }
    
    currentUser = { name, surname };
    localStorage.setItem('currentUser', JSON.stringify(currentUser));
    
    // Ã–ÄŸrenci listesine ekle
    const existingStudent = students.find(s => s.name === name && s.surname === surname);
    if (!existingStudent) {
      students.push({
        name, surname,
        joinDate: new Date().toLocaleString('tr-TR'),
        joinTimestamp: Date.now()
      });
      localStorage.setItem('students', JSON.stringify(students));
    }
    
    document.getElementById('loginModal').style.display = 'none';
    updateUI();
    initializeApp();
  });
  
  // Admin giriÅŸi
  document.getElementById('adminSwitch').addEventListener('click', function() {
    const pass = prompt("Admin ÅŸifresini girin:");
    if (pass === "GityazarkandayÄ±m") {
      isAdmin = true;
      updateUI();
      alert('Admin modu aktif!');
    } else {
      alert('Åifre yanlÄ±ÅŸ!');
    }
  });
  
  // Sync butonu
  document.getElementById('syncButton').addEventListener('click', function() {
    this.innerHTML = '<i class="fas fa-sync-alt fa-spin"></i> Syncing...';
    this.disabled = true;
    
    dataSync.syncAllData().finally(() => {
      setTimeout(() => {
        this.innerHTML = '<i class="fas fa-sync-alt"></i> Sync';
        this.disabled = false;
      }, 2000);
    });
  });
  
  // MenÃ¼ butonu
  document.getElementById('menuBtn').addEventListener('click', function() {
    document.getElementById('sidebar').classList.toggle('active');
    document.getElementById('overlay').classList.toggle('active');
  });
  
  // Overlay kapatma
  document.getElementById('overlay').addEventListener('click', function() {
    document.getElementById('sidebar').classList.remove('active');
    this.classList.remove('active');
  });
  
  // Sidebar linkleri
  document.querySelectorAll('.sidebar a[data-section]').forEach(link => {
    link.addEventListener('click', function(e) {
      e.preventDefault();
      const sectionId = this.getAttribute('data-section');
      document.querySelectorAll('.content').forEach(sec => sec.classList.remove('active'));
      document.getElementById(sectionId).classList.add('active');
      document.getElementById('sidebar').classList.remove('active');
      document.getElementById('overlay').classList.remove('active');
    });
  });
  
  // Pomodoro kontrolleri
  document.getElementById('startPomodoro').addEventListener('click', startTimer);
  document.getElementById('pausePomodoro').addEventListener('click', pauseTimer);
  document.getElementById('resetPomodoro').addEventListener('click', resetTimer);
  
  // Zaman seÃ§enekleri
  document.querySelectorAll('.time-option').forEach(option => {
    option.addEventListener('click', function() {
      document.querySelectorAll('.time-option').forEach(opt => opt.classList.remove('active'));
      this.classList.add('active');
      selectedTime = parseInt(this.dataset.minutes);
      currentTime = selectedTime * 60;
      updateTimerDisplay();
    });
  });
  
  // SÄ±nav sÄ±ralama
  document.getElementById('examSorting').addEventListener('click', (e) => {
    if (e.target.classList.contains('sort-option')) {
      document.querySelectorAll('.sort-option').forEach(opt => opt.classList.remove('active'));
      e.target.classList.add('active');
      examSortType = e.target.dataset.sort;
      renderExams();
    }
  });
  
  // Tatil seÃ§ici
  document.getElementById('changeCountdownBtn').addEventListener('click', () => {
    document.getElementById('holidaySelectorModal').style.display = 'flex';
  });
  
  document.getElementById('closeHolidayModal').addEventListener('click', () => {
    document.getElementById('holidaySelectorModal').style.display = 'none';
  });
  
  document.querySelectorAll('.holiday-option').forEach(option => {
    option.addEventListener('click', function() {
      document.querySelectorAll('.holiday-option').forEach(opt => opt.classList.remove('active'));
      this.classList.add('active');
    });
  });
  
  document.getElementById('selectHolidayBtn').addEventListener('click', function() {
    const selectedOption = document.querySelector('.holiday-option.active');
    if (selectedOption) {
      currentTargetDate = selectedOption.dataset.target;
      startCountdown();
      
      const holiday = holidayInfo[currentTargetDate];
      const countdownTitle = document.getElementById('countdownTitle');
      const holidayInfoEl = document.getElementById('holidayInfo');
      
      if (countdownTitle) {
        countdownTitle.innerHTML = `${holiday.title}<button class="change-countdown-btn" id="changeCountdownBtn"><i class="fas fa-exchange-alt"></i> DeÄŸiÅŸtir</button>`;
      }
      
      if (holidayInfoEl) holidayInfoEl.textContent = holiday.info;
      
      document.getElementById('holidaySelectorModal').style.display = 'none';
    }
  });
  
  // Ä°Ã§erik ekleme butonu
  document.getElementById('addBtn').addEventListener('click', function() {
    if (!currentUser) {
      alert('LÃ¼tfen Ã¶nce giriÅŸ yapÄ±n!');
      document.getElementById('loginModal').style.display = 'flex';
      return;
    }
    if (!isAdmin) {
      alert('Sadece admin iÃ§erik ekleyebilir!');
      return;
    }
    document.getElementById('addModal').style.display = 'flex';
  });
  
  // Modal kapatma
  document.getElementById('closeAddModal').addEventListener('click', () => {
    document.getElementById('addModal').style.display = 'none';
  });
  
  // Ä°Ã§erik kaydetme
  document.getElementById('saveContentBtn').addEventListener('click', function() {
    const type = document.getElementById('contentType').value;
    const title = document.getElementById('contentTitle').value.trim();
    const desc = document.getElementById('contentDesc').value.trim();
    const date = document.getElementById('contentDate').value;
    const importance = parseInt(document.getElementById('contentImportance').value);
    
    if (!title) {
      alert('BaÅŸlÄ±k girin!');
      return;
    }
    
    const newItem = {
      id: nextId++,
      title,
      desc,
      date,
      importance: importance
    };
    
    if (type === "exam") {
      exams.push(newItem);
      renderExams();
    } else if (type === "homework") {
      homeworks.push(newItem);
      renderHomeworks();
    } else if (type === "hadis") {
      hadises.push(newItem);
      renderHadis();
    }
    
    document.getElementById('contentTitle').value = '';
    document.getElementById('contentDesc').value = '';
    document.getElementById('contentDate').value = '';
    document.getElementById('addModal').style.display = 'none';
    renderUpcoming();
    
    setTimeout(() => dataSync.syncAllData(), 1000);
  });
  
  // ğŸ”¥ YENÄ° NOT KAYDETME
  document.getElementById('saveNoteBtn').addEventListener('click', function() {
    const title = document.getElementById('noteTitle').value.trim();
    const content = document.getElementById('noteContent').value.trim();
    const category = document.querySelector('.note-category.active').dataset.category;
    
    if (!title || !content) {
      alert('LÃ¼tfen not baÅŸlÄ±ÄŸÄ± ve iÃ§eriÄŸi girin!');
      return;
    }
    
    notes.push({
      id: nextId++,
      title,
      content,
      category,
      userKey: `${currentUser.name}_${currentUser.surname}`,
      createdAt: new Date().toISOString()
    });
    
    localStorage.setItem('notes', JSON.stringify(notes));
    renderNotes();
    document.getElementById('addNoteModal').style.display = 'none';
    
    setTimeout(() => dataSync.syncAllData(), 1000);
    alert('Not baÅŸarÄ±yla kaydedildi!');
  });
  
  // Not kategorisi seÃ§imi
  document.querySelectorAll('.note-category').forEach(category => {
    category.addEventListener('click', function() {
      document.querySelectorAll('.note-category').forEach(cat => cat.classList.remove('active'));
      this.classList.add('active');
    });
  });
  
  // Not modal kapatma
  document.getElementById('closeNoteModal').addEventListener('click', () => {
    document.getElementById('addNoteModal').style.display = 'none';
  });
  
  // UygulamayÄ± baÅŸlat
  initializeApp();
});

// ğŸ”¥ GLOBAL FONKSÄ°YONLAR
window.syncAllData = () => dataSync.syncAllData();
window.sendPomodoroData = () => dataSync.syncPomodoroData();
window.showAddNoteModal = showAddNoteModal;
window.deleteNote = deleteNote;
window.deleteItem = deleteItem;

console.log('âœ… TAM ENTEGRE SÄ°STEM HAZIR! TÃ¼m istekler eklendi!');
</script>
</body>
</html>
